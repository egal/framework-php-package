### Сортировка по нескольким полям.

Теперь клиент должен задавать сортировку следующим образом:

```
http://localhost/library/Author/getItems?&_order={"count_marks":"asc","name":"desc"}
```

Указывать asc, desc теперь обязательно. Приоритет сортировки определяется порядком указания параметров.

Внимание!
В метаданных сортировку по умолчанию нужно исправить на массив

```
$this->defaultSortBy = ['count_marks' => SortOrder::ASC, 'name' => SortOrder::DESC];
```

В данном случае сначала данные будут остортированы по count_marks по возрастанию, и затем по name по убыванию.

### Лимитирование использования очередей

Очередь сообщений теперь работает отдельно от основного редиса. Причина в том, что микросервисов может быть много, а микросервис web - один. Микросервис web не может поддерживать сотнисерверов Redis, поэтому для очередей - отдельный редис. Надо добавить в config/databases:

```
    'queue' => [
        'client' => env('REDIS_CLIENT', 'phpredis'),
        'default' => [
            'host' => env('QUEUE_HOST', '127.0.0.1'),
            'password' => env('QUEUE_PASSWORD', null),
            'port' => env('QUEUE_PORT', 6379),
            'database' => env('QUEUE_DB', 0),
        ],
    ],
```

И в .env:

```
QUEUE_HOST=keydb
```

PID файла больше нет, это ограничение снято, так как любая очередь может обрабатываться параллельно. Если потребуется PID-файл, его можно быстро восстановить, просмотрев логи git по ключевому слову PID. Этот файл может быть нужен чтобы блокировать запуск двух копий на одном контейнере, в таком случае его стоит перенести в одну из директорий /run.

Конфигурация микросервисов позволяет выполнять блокировку очередей. Для этого появился файл app/pools.json и расширена команда artisan mq:pools:

* -a - добавить очередь, которую можно слушать
* -d - удалить очередь
* -m - список слушаемых очередей

Если файл pools.json отсутствует, то обслуживаться будут все доступные очереди, иначе только те, которые присутствуют в pools.json.

Нужно так же выполнить в микросервисе обновление фреймворка командой

php artisan update

### Добавлен класс для управления ролями

```
Common\RoleManager и Session::setRoleManager и getRoleManager
```

Убран Session::getRegistry()->get('Roles'), теперь нужно использовать новый класс.

### Исправлены уязвимости

* Токен больше не действителен после выхода из системы.
* Скрыта информация об используемом ПО на сервере.

### Другие исправления

* Добавлено удаление всех конфигурации supervisor при старте контейнера.
* Исправлены баги при считывании переменных из .env файла
* Исправлен баг с аутентификацией, заключающийся в использовании неправильной часового пояса.
* Добавлен идентификатор в меню `internalName`
* Создан отдельный пунк в wiki по [аутентификации](Документация/Аутентификация-и-авторизация)
* Написана документация [по генерации меню](Документация/Меню)
* Реализация упрощеного [взаимодействия микросервисов](Документация/Общение-между-микросервисами)
* Добавлена документация по [синхронизации](Документация/Синхронизация)
* Обновлен образ backend, версия 0.7

