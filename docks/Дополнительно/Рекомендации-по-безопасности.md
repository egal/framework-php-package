Угроза работы сервиса может быть внешней или внутренней. Внешняя угроза - это риски получить от хакеров или кулхацкеров (есть разница, да) атаку, которая повредит работу сервиса или, что страшнее, данные. Внутренняя угроза - это уровень криворукости программистов и некорректные настройки приложения, которые могут привести к зависаниям, искажениям данных и/или, как результат, внешним угрозам. В данной статье угрозы типов обоих рассмотрены будут.

![7d2338c3627fefa654a2f65d0637d63a_ce_2000x1050x0x148_fitted_1260x700](uploads/f92b6c8dad97d971bad41b0b29b530c3/7d2338c3627fefa654a2f65d0637d63a_ce_2000x1050x0x148_fitted_1260x700.jpg)

## Внешние угрозы

Внешние угрозы безопасности - это, как правило, атаки, направленные на уязвимости в программном коде, либо направленные на отказ в обслуживании. То есть, атаки из-вне. Некоторые из них будут рассмотрены здесь.

### DoS и DDoS

DoS - это атака на отказ в обслуживании. DDoS - тоже самое, только распределённое, т.е. осуществляемое с различных компьютеров в сети. Этот вид атаки направлен на то, чтобы сервис под нагрузкой перестал обслуживать запросы пользователей. Такая атака бывает редко, особенно DDoS, чаще всего такие атаки производятся не целенаправленно. Однако, чтобы на некоторое время отключить сервис, такое может производиться хакерами.

DoS атаки бывают случайными, когда ошибка в коде уводит сервис в бесконечный цикл, вызывает переполнение буфера, утечки памяти и так далее. Например, при автоматической генерации очередей на продакшене, можно вызвать отказ в обслуживании, создав на один запрос много очередей. В результате будет запущено много копий демона и рано или поздно закончится память.

### SQL injection

Ошибки обработки пользовательских данных могут приводить к инъекциям в запросах к базам данных. Eloquent, как и наши обёртки для модели, защищены от атак, однако использование SQL запросов в коде может привести к подобного типа атакам. SQL запросы могут быть использованы для оптимизации скорости работы фреймворка, однако, используя их, нужно внимательно относиться к пользовательскому вводу.

### XSS

Этот вид атак возникает на фронтенде, когда пользовательские данные, сохранённые в базе, содержат в себе JavaScript код. Нужно учитывать, что со стороны бэкенда хранение пользовательских данных предпочтительно без обработки, отдача происходит так же без обработки. Должен храниться оригинал. Обработка исполняемого кода должна производиться на стороне фронта. Такой вид атаки даёт атакующему доступ к пользовательским данным посетителей сайта во фронтовой части и позволяет передать их на третью сторону.

### Социальная инженерия

Самый распространённый вид атаки - атака на человеческую глупость. Письма из девяностых про дедушку, умершего в Нигерии, который оставил для вас наследство в миллион денег - самый показательный пример. Отправьте нам 10 баксов, чтобы мы убедились что вы - это вы, и мы перечислим вам миллион денег долларов. Письма с запускаемыми файлами, которые содержат в себе троян. И прочее, прочее и прочее. Прежде, чем отправить деньги, логины, пароли и явки, стоит пошевелить мозгами. Вам уже звонили из службы безопасности Сбербанка о том, что ваш аккаунт заблокирован?

## Внутренние угрозы

Внутренние угрозы - самые вероятные из всех. Это ошибки в коде, в логике, неправильная настройка, забытый код и так далее. Но мы - люди, мы ошибаемся. Если бы не ошибались - были бы роботами. С одной стороны человеческий фактор вероятен всегда, однако от таких ошибок можно защититься путём составления чек-листов, автоматических проверок на ошибки и так далее.

### Настройки окружения

При неправильных настройкаих окружения могут возникнуть следующие проблемы:

* Возможность пользователю создавать очереди - приводит к DoS атакам
* Передача SQL запросов пользователю
* Фатальные ошибки и падение сервисов
* Повреждение данных

И много других ошибок.

### Говнокод

Если не следовать общепринятым стандартам, то другой специалист будет с трудом читать код. Это усложняет поддержку и поиск ошибок, так как код написан не так как привычно. Поэтому и существуют стандарты. Чем длиннее метод - тем больше вероятность возникновения ошибки. Запутанный код так же делает сложным поиск ошибок и повышает их вероятность. Поэтому код должен быть чистым и аккуратным.

### Методология K&V

Методология K&V - прекрасная методология для внедрения на стороне конкурента. K&V - это Kostyl & Velosiped. Костыли в коде - это когда делаешь быстрый фикс проблемы вместо того чтобы подумать и сделать правильно. Костыли допусимы для закрытия бага в коде в срочном порядке. Но, после такого срочного порядка, нужно создать задачу и исправить ошибку системно. Костыли опасны тем, что про них забываешь и поведение приложения может стать непредсказуемым.

Велосипеды - это создание того, что уже создано другими пользователями. Создание и поддержка своего кода - это накладные расходы. По возможности стоит использовать сторонний код, если это позволяют правила безопасности. Однако, сторонний код имеет смысл просмотреть и оценить его качество, прежде чем использовать.

## Как защититься во фреймворке

* На продакшене нужно отключить режим отладки приложения, это делается в файле .env, параметр APP_DEBUG и APP_ENV=prod
* DEFAULT_MAX_RELATIONS - установить максимально допустимое количество отношений, возвращаемых по запросу _with
* SESSION_TTL - на сервисе аутентификации установить время максимальной жизни сессии при бездействии пользователя
* DAEMON_USER - нельзя указывать суперпользователя или пользователя, который относится к какому-либо системному сервису
* APP_KEY - у всех сервисов должен быть разный приватный ключ
* Контроль очередей - QUEUE_POOL_MANAGER, должен быть manual или semi для продакшена, настраивается на стороне микросервиса web
* Вход в СУБД должен осуществляться не от суперпользователя, а от отдельного пользователя для каждого микросервиса