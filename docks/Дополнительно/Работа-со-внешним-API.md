Обращение к сервису - это прямое обращение к модели без указанных вручную маршрутов и контроллеров. Возвращается клиенту то, что возвращается из метода модели, при этом переводится в JSON.

Формат URI /service[-queue]/model[/action][/id]. Схема без указания Где:

| Параметр | Обязательный | Описание |
| -------- | ------------ | -------- |
| service | да |  имя сервиса для обращения, например p2p |
| queue | нет | можно создать отдельную очередь и отправлять всё через неё, иначе на каждую модель своя очередь |
| model | да | модель, например Article |
| action | нет | метод модели, например create, некоторые методы могут быть заменены методом HTTP |
| id | нет | если указать, то будет вестись работа не с чистой моделью, а с объектом, взятым из базы, значение целочисленное |

Например: http://localhost/p2p-somequeue/Article/getItem/1. В описании будет указана часть URI, начиная от модели.
JSON в теле сообщения содержит параметры вызова метода и передаёт их напрямую в модель. Например: [“first param”, 123, “zzz”]

*GET-запросы кэшируются*. Схема работы без указания действия:

| Метод | ID | Заменяет метод | Результат |
| ----- | -- | -------------- | --------- |
| GET | есть | getItem | Получение единственной записи из базы по id |
| GET | нет | getItems | Получение списка записей из БД |
| POST | есть | create | Будет возвращена ошибка |
| POST | нет | create | Будет создана запись в базе |
| PUT | есть | update | Будет обновлена запись в базе, если такая существует |
| PUT | нет | update | Будет возвращена ошибка |
| DELETE | есть | delete | Удалить запись из базы |
| DELETE | нет | delete | Будет возвращена ошибка |

CRUD
===

C
---

Единственный параметр метода - ассоциативный массив данных, где ключ - это поле в базе, значение, соответственно, то что будет туда записано.

Method: POST

URI: Section/create или Section без параметров

JSON payload: [{"parent_id": 0,"name": "Section One"}]

R
---

Чтение одного элемента по id.

Method: GET

URI: Section/getItem/1 или Section/1

Вывод дерева будет когда существует поле parent_id у сущности. Тело документа может отсутствовать, тогда по-умолчанию будет браться всё от корня.

Method: GET

URL: Menu/getTree/3 [по-умолчанию 0]

Вывод списка обучен способностям фильтрации.

Method: GET

URI: Article/getItems?_order_by=id&_order=desc&field1=qwe&field2=123&_search={field3: “zzz”}&_from=0&_count=100&_range_from={“price”: 1000}&_range_to={“price”:10000}

или

Article?_order_by=id&_order=desc&field1=qwe&field2=123&_search={field3: “zzz”}&_from=0&_count=100&_range_from={“price”: 1000}&_range_to={“price”:10000}&_full_search

Поиск в по точным значениям отдельных полей осуществляется при передаче в виде ключ-значение, например name=Vasya. Поиск по множеству осуществляется при использовании квадратных скобок и значений, разделённых запятыми: id=%5B1%2C3%5D', если сделать urldecode, получим [1,3].

Специальные поля:

* _order_by - поле, по которому будет проходить сортировка
* _order - в каком направлении сортировать ASC или DESC
* _search - JSON с полями по которым нужно искать по подстроке
* _from - лимитирование выборки, с какого элемента выбирать, по-умолчанию 0
* _count - лимитирование выборки, сколько элементов выбирать, по-умолчанию 10, не может быть больше 100 или меньше 1
* _range_from - JSON, поиск по значениям не менее
* _range_to - JSON, поиск по значениям не более
* _full_search - полнотекстовый поиск по всем полям, включается отдельно в метаданных
* _rel_id - поиск по отношениям, id объекта для поиска
* _rel_model - исходная модель, по которой нужно искать

При поиске по отношениям, если отношения User -many_to_many-> Account, то запрос делаем к модели Account?_rel_id={{user_id}}&_rel_model=User.

U
---

Обновление похоже на создание, только там передаются только те поля, которые надо изменить.

Method: PUT

URI: Menu/update/6 или Menu/6

JSON payload: [{“parent_id”: 6}]

D
---

Method: DELETE

URI: Menu/delete/6 или Menu/6