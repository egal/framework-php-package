## Описание

Профилирование необходимо для того, чтобы посмотреть где код просаживается по времени и памяти. Для этого используется:

* Модуль php-tideways
* Библиотеки composer
  * perftools/php-profiler
  * perftools/xhgui-collector
* Собственная инфраструктура docker с базой данных и веб-мордой

## Как пользоваться

Установка достаточно проста:

1. Инициализируем инфраструктуру профилирования: vmng pinit
1. Включение-выключение инфраструктуры - команды pstart и pstop
1. Результаты профилирования можно созерцать по адресу http://localhost:8142
1. Токен указывается в файле smart-world/profiler/config/config.php в директиве upload.token, если нужен

Код ниже позволяет создать объект для профилирования:

```php
        $profiler = new Profiler([
            'save.handler' => \Xhgui\Profiler\Profiler::SAVER_UPLOAD,
            'save.handler.upload' => array(
                'uri' => 'http://' . Settings::getHostAddress() . ':8142/run/import',
                'timeout' => 3,
                'token' => 'qweqwe',
            ),
        ]);
```

Функции Settings::getHostAddress() пока нет, но она появится в скором будущем. Эта функция скажет IP адрес хоста. Но пока для получения адреса хоста нужно использовать команду из консоли контейнера backend:

```bash
route | grep default | awk '{ print $2 }'
```

Этот адрес кэшируется один раз при сборке контейнера, поэтому использовать можно один раз, а потом пользоваться пока не выйдет новая версия контейнера backend.

Для запуска профилирования:

```php
$profiler->start();
```

Для остановки и записи:

```php
$profiler->stop();
```